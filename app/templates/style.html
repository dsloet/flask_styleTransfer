{% extends "layout.html" %}

{% block content %}

<h1 class="ui header">{{title}}</h1>

{% if current_user.is_authenticated %}
<h2 class="ui header"> Hi {{ current_user.first_name }}!</h2>
<br>
<h3 class="ui text">Upload your style image here:</h3>

<form id="upload-form" action="{{ url_for('upload_style') }}" method="POST" enctype="multipart/form-data">

    <strong>Files:</strong><br>
    <input id="file-picker" type="file" name="file" accept="image/*" multiple>
    <div id="msg"></div>
    <input type="submit" value="Upload!" id="upload-button">
</form>

<h2 class="ui header"> {{ success }}</h2>

<div>
    {% block style_image %}{% endblock %}
</div>

<script>

    $("#file-picker").change(function () {

        var input = document.getElementById('file-picker');

        for (var i = 0; i < input.files.length; i++) {
            //koala.jpg, koala.JPG substring(index) lastIndexOf('a') koala.1.jpg
            var ext = input.files[i].name.substring(input.files[i].name.lastIndexOf('.') + 1).toLowerCase()

            if ((ext == 'jpg') || (ext == 'png')) {
                $("#msg").text("Files are supported")
            }
            else {
                $("#msg").text("Files are NOT supported")
                document.getElementById("file-picker").value = "";
            }

        }


    });

</script>

<script type="text/javascript">
    function refresh_style() {
        $.ajax({
            type: "POST",
            async: true,
            url: "/uploads/style.jpg"
        }).done();
    }

    refresh_style();
    window.setInterval(function () {
        refresh_points();
    }, 1000);
</script>

{% else %}
<h2 class="ui header">Please login</h2>
{% endif %}



{% endblock %}